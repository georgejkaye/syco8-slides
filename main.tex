\documentclass[aspectratio=169]{beamer}

\usepackage{ stmaryrd }

\usepackage{ tikz }
\usepackage{ tikz-cd }
\usepackage{ figures/tikzit }
\usepackage{ tikz/quiver }
\usepackage{ standalone }
\usetikzlibrary{decorations.markings}

\usetheme[
  background=light,
  numbering=counter,
  block=fill,
  %sectionpage=simple
]{metropolis}

\tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt={#1{}{invisible}}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}}%
  }
}

\input{macros/letters}
\input{macros/sets}
\input{macros/circuits}
\input{macros/category}
\input{macros/streams}
\input{figures/circuits.tikzstyles}

% FiraFonts
\usepackage[sfdefault]{FiraSans}
\usepackage{FiraMono}
% Use thinner fonts
\makeatletter
\def\bfseries@sf{medium}
\def\mdseries@sf{l}
\makeatother

\definecolor{backg}{RGB}{9,72,61}
\definecolor{accent}{RGB}{0,150,136}

\definecolor{dracback}{RGB}{40, 42, 54}
\definecolor{dracfore}{RGB}{248, 248, 242}
\definecolor{dractitle}{RGB}{56, 58, 89}
\definecolor{dracblock}{RGB}{98, 114, 164}
\definecolor{draccent}{RGB}{255, 121, 198}

\setbeamercolor{normal text}{bg=dracfore}
\setbeamercolor{frametitle}{bg=dractitle, fg=dracfore}
\setbeamercolor{title separator}{fg=draccent}
\setbeamercolor{progress bar}{fg=draccent, bg=draccent}
\setbeamercolor{block title}{fg=dracfore, bg=dracblock}
\setbeamercolor{alerted text}{fg=draccent}

\newtheorem{proposition}{Proposition}

\title{Normalisation by evaluation for digital circuits}
\author{\texorpdfstring{\large\textbf{George Kaye}, Dan R. Ghica, David Sprunger \\ \normalsize University of Birmingham}{George Kaye}}
\institute{SYCO 8}
\date{13 December 2021}

\begin{document}

    \maketitle

    \begin{frame}
        \frametitle{Hello!}
    
        
    
    \end{frame}

    \section{Categorical semantics for digital~circuits}

    \begin{frame}
        \frametitle{Circuit signature}
    
        \pause

        \alert{Values} $\textbf{V}$ forming a lattice.

        \pause

        \alert{Gates} $g$ with associated monotonic functions $\morph{\bar{g}}{\textbf{V}^m}{\textbf{V}}$.


        \pause

        \[\textbf{V} = \tikzfig{streams/lattice}\]

        \pause

        \[\Sigma = (\textbf{V}, \{\morph{\ \mf{AND}}{\textbf{V}^2}{\textbf{V}},\ \morph{\mf{OR}}{\textbf{V}^2}{\textbf{V}}\ \})\]

    \end{frame}

    \begin{frame}
        \frametitle{Combinational circuits}

        \pause

        Circuits are morphisms generated freely over a signature $\Sigma$.

        \begin{center}
            \tikzfig{circuits/components/bot}
            \tikzfig{circuits/components/t}
            \tikzfig{circuits/components/f}
            \tikzfig{circuits/components/top}

            \pause

            \vspace{1em}

            \tikzfig{circuits/components/and}
            \tikzfig{circuits/components/or}
        \end{center}

        \vspace{1em}

        \pause

        Alonmg with \alert{structural} generators 

        \begin{center}
            \tikzfig{circuits/components/fork}
            \quad
            \tikzfig{circuits/components/join}
            \quad
            \tikzfig{circuits/components/stub}
        \end{center}

        Composed together in sequence or parallel with \alert{identities} and \alert{symmetries}.

    \end{frame}

    \begin{frame}
        \frametitle{Combinational circuits: axioms}
        \begin{center}
            \vspace{2em}

            \scalebox{1}{\tikzfig{circuits/axioms/fork-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/fork-rhs}}
            %
            \hspace{2em}
            \pause
            %
            \scalebox{1}{\tikzfig{circuits/axioms/join-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/join-rhs}}
            
            \vspace{2em}
            \pause
            
            \scalebox{1}{\tikzfig{circuits/axioms/stub-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/stub-rhs}}
            %
            \pause
            \hspace{2em}
            %
            \scalebox{1}{\tikzfig{circuits/axioms/gate-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/gate-rhs}}

        \end{center}
    \end{frame}

    \begin{frame}
        \frametitle{Combinational circuits: extensional equivalence}

        \pause

        \begin{center}
            \tikzfig{circuits/cartesian/extensional-equivalence-lhs}
            \quad$=$\quad
            \tikzfig{circuits/cartesian/extensional-equivalence-res}
            \quad$=$\quad
            \tikzfig{circuits/cartesian/extensional-equivalence-rhs}
        \end{center}
        
        \pause

        $f$ and $f^\prime$ are \alert{extensionally equivalent}.

        \pause

        \vspace{1em}

        \begin{theorem}[Extensionality: Ghica and Jung, 2016]
            For any circuit \tikzfig{circuits/components/fcirc} and values \tikzfig{circuits/components/values}, there exists values \tikzfig{circuits/cartesian/extensional-equivalence-res} such that $\tikzfig{circuits/cartesian/extensional-equivalence-lhs} = \tikzfig{circuits/cartesian/extensional-equivalence-res}$.
        \end{theorem}
    \end{frame}

    \begin{frame}
        \frametitle{Combinational circuits}
    
        \begin{center}
            \scalebox{1.5}{$\text{generators} \quad + \quad \text{axioms} \quad $}
            
            \vspace{1em}
            
            \scalebox{1.5}{$+ \quad \text{extensional equivalence} \quad = \quad \ccirc[\Sigma]$}
        \end{center}
    \end{frame}

    \begin{frame}
        \frametitle{Temporal circuits}
    
        Combinational circuits are \alert{boring}.

        \pause

        \alert{Delay} is represented by a new generator 
        
        \vspace{2em}

        \begin{center}
            \scalebox{2}{\tikzfig{circuits/components/delay}}
        \end{center}

    \end{frame}

    \begin{frame}
        \frametitle{Temporal circuits: axioms}
        \begin{center}
            \vspace{2em}

            \scalebox{1}{\tikzfig{circuits/axioms/timelessness-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/timelessness-rhs}}
            %
            
            \vspace{2em}
            \pause

            \scalebox{1}{\tikzfig{circuits/axioms/unobservable-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/unobservable-rhs}}
            %
            \hspace{3.5em}
            \pause
            %
            \scalebox{1}{\tikzfig{circuits/axioms/disconnect-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/disconnect-rhs}}

            \vspace{2em}
            \pause

            %
            \scalebox{1}{\tikzfig{circuits/axioms/streaming-lhs}}
            \quad$=$\quad
            \scalebox{1}{\tikzfig{circuits/axioms/streaming-rhs}}

        \end{center}
    \end{frame}

    \begin{frame}
        \frametitle{Temporal circuits}
     
        \begin{center}
            \scalebox{1.5}{$\ccirc[\Sigma] + \scalebox{1}{\tikzfig{circuits/components/delay}} + \text{axioms} \quad = \quad \tcirc[\Sigma]$}
        \end{center}
    
    \end{frame}
    \begin{frame}
        \frametitle{Sequential circuits}
    
        \pause

        Sequential circuits have delay and \alert{feedback}.
        
        \pause

        We freely add a \alert{trace operator}.

        \pause

        \begin{center}
            \tikzfig{strings/traced/trace-lhs}
            \quad$\xrightarrow{\trace{1}{-}}$\quad
            \tikzfig{strings/traced/trace-rhs}
        \end{center}        

        \pause

        \vspace{1.5em}

        \begin{center}
            \scalebox{1.5}{$\tcirc[\Sigma] \quad + \quad \text{trace} \quad = \quad \scirc[\Sigma]$}
        \end{center}

    \end{frame}
    \begin{frame}
        \frametitle{Sequential circuits}

        \pause

        \begin{theorem}[Ghica and Jung, 2016]
            $\scirc[\Sigma]$ is cartesian.
        \end{theorem}
        \pause
        \begin{center}
            \tikzfig{strings/cartesian/naturality-copy-lhs}
            \pause
            \quad$=$\quad
            \tikzfig{strings/cartesian/naturality-copy-rhs}
            \quad\quad
            \pause
            \tikzfig{strings/cartesian/naturality-discard-lhs}
            \pause
            \quad$=$\quad
            \tikzfig{strings/cartesian/naturality-discard-rhs}
        \end{center}
        \pause
        We can \alert{copy} and \alert{discard} data.

    \end{frame}

    \begin{frame}
        \frametitle{Sequential circuits: unfolding}

        \pause

        Traced cartesian categories admit the \alert{unfolding} rule.

        \pause
        \vspace{1em}

        \begin{center}
            \tikzfig{strings/dataflow/unfolding-lhs}
            \pause
            \quad$=$\quad
            \tikzfig{strings/dataflow/unfolding-rhs}
        \end{center}

        \pause

        Crucial part of the operational semantics!
    \end{frame}

    \section{Evaluating digital circuits}

    \begin{frame}
        \frametitle{Productivity}
    
        For \alert{closed circuits} the aim is to reduce to a (\alert{possibly infinite}) sequence of values.        

        \pause

        \begin{center}
            \tikzfig{circuits/productivity/step-0}
            \quad$=$\quad
            \scalebox{0.5}{\tikzfig{streams/streamcirc-simple}}
        \end{center}


        \pause

        Circuits that do this are called \alert{productive}.
    
    \end{frame}

    \begin{frame}
        \frametitle{Delay-guarded feedback}
    
        Some circuits have \alert{delay-guarded feedback}.

        \pause

        \begin{center}
            \tikzfig{circuits/productivity/step-0}
            \pause
            \quad$=$\quad
            \tikzfig{circuits/productivity/delay-guarded}
        \end{center}

        where $\hat{F}$ is combinational.

        \pause

        \vspace{1em}
    
        \begin{theorem}[Ghica, Jung and Lopez, 2017]
            Circuits with delay-guarded feedback are productive.
        \end{theorem}

    \end{frame}

    \begin{frame}
        \frametitle{`Instant' feedback}
    
        But not all non-delay-guarded circuits are unproductive!
        
        \pause

        \begin{center}
            \tikzfig{circuits/examples/cyclic-combinational}
            \pause
            \quad$=$\quad
            \tikzfig{circuits/examples/cyclic-combinational-reduced}
        \end{center}

        \pause

        A clever way of \alert{sharing resources}.

    \end{frame}

    \begin{frame}
        \frametitle{Unproductive circuits}
    
        However some non-delay-guarded circuits \alert{are} unproductive...
    
        \begin{center}
            \pause
            \tikzfig{circuits/productivity/trand}
            \pause
            \quad$=$\quad
            \tikzfig{circuits/productivity/trand-unfold}

        \end{center}

    \end{frame}

    \begin{frame}
        \frametitle{Unproductive circuits -- what to do?}
    
        Ban non-delay-guarded circuits?

        \pause

        This would mean we can't model cyclic combinational circuits.

        \pause

        Also implies we are working in a category with \alert{delayed trace}.
        
        \pause

        We would lose the \alert{unfolding} rule.
    
    \end{frame}

    \begin{frame}
        \frametitle{Eliminating `instant' feedback}
    
        Our gates are \alert{monotonic}.

        By the \alert{Kleene's fixed point theorem} the circuits must have a \alert
        {least fixed point}.
        %
        \[\text{lfp}(f) = \text{sup}(\{\,f^n(\bot) \,|\, n \in \nat\,\})\]
        %
        Since $\textbf{V}$ is finite, we will always be able to find this fixpoint!
    \end{frame}

    \begin{frame}
        \frametitle{Eliminating `instant' feedback}
    
        
        \begin{center}
            \tikzfig{circuits/productivity/trand} 
            \pause
            \quad$=$\quad
            \tikzfig{circuits/productivity/trand-instfb}

            \vspace{1em}

            \pause
            \quad$=$\quad
            \tikzfig{circuits/productivity/trand-instfb-reduced-1}
            \pause
            \quad$=$\quad
            \tikzfig{circuits/productivity/trand-instfb-reduced-2}
            \pause
            \quad$=$\quad
            \tikzfig{circuits/productivity/trand-instfb-reduced-3}
        \end{center}

    
    \end{frame}

    \begin{frame}
        \frametitle{Productivity, redux}
    
        \begin{theorem}
            For any circuit $\,\tikzfig{circuits/components/fcirc-closed}\,$, there exists values $\,\tikzfig{circuits/components/values}\,$ and combinational $\,\tikzfig{circuits/components/gcirc-closed}\,$ such that 

            \pause

            \begin{center}
                \tikzfig{circuits/components/fcirc} 
                \quad$=$\quad
                \tikzfig{circuits/productivity/productive} 
            \end{center}
        \end{theorem}
    
        \pause
        \alert{All} circuits are productive!

    \end{frame}

    \section{Mealy machines}

    \begin{frame}
        \frametitle{}
    
        
    
    \end{frame}

    \begin{frame}
        \frametitle{Mealy machine}

        Mealy machines are a \alert{finite state machine}.

        \pause

        Given an input, produces a \alert{next state} and an \alert{output}.
        
        \pause

        For state $s_1$, input $v$, next state $s_2$ and output $w$, written $s_1 \xrightarrow{v \,|\, w} s_2$

    \end{frame}

    \begin{frame}
        \frametitle{Mealy machines}
    
        To model circuits, we set the input, output and state space to powers of $\textbf{V}$.

        \pause

        For example...

        \pause

        \begin{center}
            \includestandalone{tikz/streams/mealy-whitebox}
        \end{center}
    
    \end{frame}


    \begin{frame}
        \frametitle{Interpreting $\scirc[\Sigma]$}
    
        
    
    \end{frame}

    \begin{frame}
        \frametitle{}
    
        \begin{theorem}
            For any $F,G \in \scirc[\Sigma]$, if $F = G$ then $\tomm[F] \equiv \tomm[G]$.
        \end{theorem}
    
    \end{frame}

    \section{Streams}

    \section{Open circuits}

    \begin{frame}
        \frametitle{Open circuits}
    
        The next step...
    
    \end{frame}

\end{document}